<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Registro PR's+ Sync</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; overscroll-behavior-y: none; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-fade { animation: fadeIn 0.4s ease-out; }
        .is-expanded { max-height: 2000px; opacity: 1; overflow: auto; transition: max-height 0.3s ease-out; }
        .is-collapsed { max-height: 0; opacity: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
    </style>
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.300.0"
        }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="text-gray-900">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { BarChart2, Plus, Trash2, Pencil, Trophy, Sparkles, Brain, X, Settings, Download, Upload, Flame, LayoutGrid, ChevronDown, RefreshCw, TrendingUp, Hash, Clock, Route, Search, AlertTriangle, ChevronUp, CloudSync } from 'lucide-react';

        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbw6PNmQm1b-gK2p2mGfa9-qNIsZJl4-dYDMC-ue3EpQ9OSda-Nz7sJalLRltSZLAGosKg/exec";

        // COPIE O SEU EXERCISE_CATALOG ORIGINAL AQUI (Mantive o reduzido para o código não ficar gigante, mas você pode colar o seu completo)
        const EXERCISE_CATALOG = {
            "Peitoral": { "Supino Reto": ["Barra Livre", "Halteres"], "Crossover": ["Polia Alta", "Polia Baixa"] },
            "Costas": { "Puxada Alta": ["Frente", "Triângulo"], "Remada Curvada": ["Barra", "Halter"] },
            "Cardio": { "Corrida": ["Rua", "Esteira"], "Bike": ["Spinning"] }
        };

        const StorageService = {
            getLogs: () => JSON.parse(localStorage.getItem('registro_prs_logs_v2') || '[]'),
            saveLogs: (logs) => localStorage.setItem('registro_prs_logs_v2', JSON.stringify(logs))
        };

        function App() {
            const [activeTab, setActiveTab] = useState('metrics');
            const [logs, setLogs] = useState([]);
            const [isSyncing, setIsSyncing] = useState(false);

            useEffect(() => {
                setLogs(StorageService.getLogs());
                handleSync();
            }, []);

            const handleSync = async () => {
                setIsSyncing(true);
                try {
                    const res = await fetch(WEB_APP_URL);
                    const data = await res.json();
                    if (Array.isArray(data)) {
                        setLogs(data);
                        StorageService.saveLogs(data);
                    }
                } catch (e) { console.error(e); }
                setIsSyncing(false);
            };

            const onAddLog = async (newLog) => {
                const updated = [newLog, ...logs];
                setLogs(updated);
                StorageService.saveLogs(updated);
                await fetch(WEB_APP_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(newLog) });
            };

            return (
                <div className="min-h-screen pb-24 flex flex-col">
                    <header className="bg-slate-900 text-white p-4 flex justify-between items-center sticky top-0 z-50">
                        <div className="flex items-center space-x-2">
                            <Trophy className="text-yellow-400" />
                            <h1 className="font-black italic">PR'S <span className="text-indigo-400">SYNC</span></h1>
                        </div>
                        <button onClick={handleSync} className={`${isSyncing ? 'animate-spin' : ''}`}>
                            <CloudSync className="w-6 h-6" />
                        </button>
                    </header>

                    <main className="max-w-4xl mx-auto p-4 w-full">
                        {activeTab === 'log' ? <LoggerSection onAddLog={onAddLog} /> : <MetricsSection logs={logs} />}
                    </main>

                    <nav className="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around p-2 shadow-lg z-50">
                        <button onClick={() => setActiveTab('metrics')} className={`flex flex-col items-center p-2 ${activeTab === 'metrics' ? 'text-indigo-600' : 'text-gray-400'}`}>
                            <BarChart2 /> <span className="text-[10px] font-bold">Dash</span>
                        </button>
                        <button onClick={() => setActiveTab('log')} className={`flex flex-col items-center p-2 ${activeTab === 'log' ? 'text-indigo-600' : 'text-gray-400'}`}>
                            <Plus /> <span className="text-[10px] font-bold">Registrar</span>
                        </button>
                    </nav>
                </div>
            );
        }

        // --- SUB-COMPONENTES (Logger e Metrics adaptados do seu original) ---
        function LoggerSection({ onAddLog }) {
            const [group, setGroup] = useState('Peitoral');
            const [exercise, setExercise] = useState('');
            const [variation, setVariation] = useState('');
            const [weight, setWeight] = useState('');
            const [reps, setReps] = useState('');

            const handleSave = (e) => {
                e.preventDefault();
                onAddLog({
                    id: Date.now(),
                    workoutDate: new Date().toISOString().split('T')[0],
                    muscleGroup: group, exercise, variation, weight, reps
                });
                alert("Sincronizado!");
            };

            return (
                <div className="bg-white p-6 rounded-3xl shadow-sm border animate-fade">
                    <h2 className="font-bold mb-4 flex items-center"><Plus className="mr-2 text-indigo-500"/> Novo PR</h2>
                    <form onSubmit={handleSave} className="space-y-4">
                        <select value={group} onChange={e => setGroup(e.target.value)} className="w-full p-3 bg-gray-50 rounded-xl border">
                            {Object.keys(EXERCISE_CATALOG).map(g => <option key={g} value={g}>{g}</option>)}
                        </select>
                        <select value={exercise} onChange={e => setExercise(e.target.value)} className="w-full p-3 bg-gray-50 rounded-xl border">
                            <option value="">Exercício...</option>
                            {Object.keys(EXERCISE_CATALOG[group]).map(ex => <option key={ex} value={ex}>{ex}</option>)}
                        </select>
                        <div className="grid grid-cols-2 gap-3">
                            <input type="number" placeholder="Peso" value={weight} onChange={e => setWeight(e.target.value)} className="p-3 bg-gray-50 rounded-xl border text-center font-bold" />
                            <input type="number" placeholder="Reps" value={reps} onChange={e => setReps(e.target.value)} className="p-3 bg-gray-50 rounded-xl border text-center font-bold" />
                        </div>
                        <button className="w-full bg-indigo-600 text-white font-bold py-4 rounded-xl shadow-lg">CONFIRMAR</button>
                    </form>
                </div>
            );
        }

        function MetricsSection({ logs }) {
            return (
                <div className="space-y-4 animate-fade">
                    <div className="bg-white p-5 rounded-3xl shadow-sm border">
                        <h3 className="font-bold text-gray-800 flex items-center mb-4"><Trophy className="w-4 h-4 mr-2 text-yellow-500" /> HISTÓRICO SYNC</h3>
                        {logs.length === 0 ? <p className="text-gray-400 text-center py-10">Nenhum dado na nuvem.</p> : 
                        logs.map(log => (
                            <div key={log.id} className="flex justify-between items-center border-b py-3 last:border-0">
                                <div>
                                    <div className="font-bold text-sm">{log.exercise}</div>
                                    <div className="text-[10px] text-gray-400">{log.workoutDate}</div>
                                </div>
                                <div className="text-right">
                                    <div className="font-black text-indigo-600">{log.weight}kg</div>
                                    <div className="text-[10px] text-gray-400">{log.reps} reps</div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
