<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Registro PR's+ Sync</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; overscroll-behavior-y: none; }
        .animate-fade { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .is-expanded { max-height: 2000px; opacity: 1; overflow: auto; transition: max-height 0.3s ease-out; }
        .is-collapsed { max-height: 0; opacity: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
    </style>
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.300.0"
        }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="text-gray-900">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { BarChart2, Plus, Trash2, Trophy, Settings, CloudSync, ChevronDown, Flame, LayoutGrid, Sparkles, Clock, Route, Search, X } from 'lucide-react';

        // URL DA SUA API (PLANILHA)
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbw6PNmQm1b-gK2p2mGfa9-qNIsZJl4-dYDMC-ue3EpQ9OSda-Nz7sJalLRltSZLAGosKg/exec";

        const EXERCISE_CATALOG = {
            "Peitoral": { "Supino Reto": ["Barra", "Halter"], "Crossover": ["Polia Alta", "Polia Baixa"] },
            "Costas": { "Puxada Alta": ["Aberta", "Triângulo"], "Remada Curvada": ["Barra", "Halter"] },
            "Pernas": { "Agachamento": ["Livre", "Hack"], "Leg Press": ["45 Graus", "Horizontal"] },
            "Cardio": { "Esteira": ["Caminhada", "Corrida"], "Bike": ["Spinning"] }
        };

        function App() {
            const [activeTab, setActiveTab] = useState('metrics');
            const [logs, setLogs] = useState([]);
            const [isSyncing, setIsSyncing] = useState(false);

            // Carregar dados ao iniciar
            useEffect(() => {
                const localData = localStorage.getItem('prs_local_logs');
                if (localData) setLogs(JSON.parse(localData));
                syncWithCloud();
            }, []);

            const syncWithCloud = async () => {
                setIsSyncing(true);
                try {
                    const response = await fetch(WEB_APP_URL);
                    const cloudData = await response.json();
                    if (Array.isArray(cloudData)) {
                        setLogs(cloudData);
                        localStorage.setItem('prs_local_logs', JSON.stringify(cloudData));
                    }
                } catch (e) { console.error("Erro ao sincronizar", e); }
                setIsSyncing(false);
            };

            const saveLog = async (newLog) => {
                const updated = [newLog, ...logs];
                setLogs(updated);
                localStorage.setItem('prs_local_logs', JSON.stringify(updated));
                
                // Enviar para a planilha
                await fetch(WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify(newLog)
                });
            };

            return (
                <div className="min-h-screen pb-20">
                    <header className="bg-slate-900 text-white p-4 flex justify-between items-center sticky top-0 z-50">
                        <h1 className="font-black italic text-lg">PR'S <span className="text-indigo-400">SYNC</span></h1>
                        <button onClick={syncWithCloud} className={`${isSyncing ? 'animate-spin' : ''}`}>
                            <CloudSync className="w-6 h-6" />
                        </button>
                    </header>

                    <main className="p-4 max-w-md mx-auto">
                        {activeTab === 'log' ? (
                            <LogForm onSave={saveLog} />
                        ) : (
                            <Dashboard logs={logs} />
                        )}
                    </main>

                    <nav className="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around p-2 shadow-lg">
                        <button onClick={() => setActiveTab('metrics')} className={`flex flex-col items-center ${activeTab === 'metrics' ? 'text-indigo-600' : 'text-gray-400'}`}>
                            <BarChart2 /> <span className="text-[10px] font-bold">Dash</span>
                        </button>
                        <button onClick={() => setActiveTab('log')} className={`flex flex-col items-center ${activeTab === 'log' ? 'text-indigo-600' : 'text-gray-400'}`}>
                            <Plus /> <span className="text-[10px] font-bold">Registrar</span>
                        </button>
                    </nav>
                </div>
            );
        }

        function LogForm({ onSave }) {
            const [group, setGroup] = useState('Peitoral');
            const [exercise, setExercise] = useState('');
            const [variation, setVariation] = useState('');
            const [weight, setWeight] = useState('');
            const [reps, setReps] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave({
                    workoutDate: new Date().toISOString().split('T')[0],
                    exercise, variation, weight, reps, 
                    id: Date.now()
                });
                setWeight(''); setReps('');
                alert("Salvo na planilha!");
            };

            return (
                <form onSubmit={handleSubmit} className="space-y-4 bg-white p-6 rounded-3xl shadow-sm">
                    <h2 className="font-bold text-gray-800">Novo Registro</h2>
                    <select onChange={e => setGroup(e.target.value)} className="w-full p-3 bg-gray-50 rounded-xl border">
                        {Object.keys(EXERCISE_CATALOG).map(g => <option key={g} value={g}>{g}</option>)}
                    </select>
                    <select onChange={e => setExercise(e.target.value)} className="w-full p-3 bg-gray-50 rounded-xl border">
                        <option value="">Selecione o Exercício</option>
                        {Object.keys(EXERCISE_CATALOG[group]).map(ex => <option key={ex} value={ex}>{ex}</option>)}
                    </select>
                    <div className="grid grid-cols-2 gap-4">
                        <input type="number" placeholder="Peso (kg)" value={weight} onChange={e => setWeight(e.target.value)} className="p-3 bg-gray-50 rounded-xl border text-center font-bold" />
                        <input type="number" placeholder="Reps" value={reps} onChange={e => setReps(e.target.value)} className="p-3 bg-gray-50 rounded-xl border text-center font-bold" />
                    </div>
                    <button className="w-full bg-indigo-600 text-white font-bold py-4 rounded-xl">SALVAR TREINO</button>
                </form>
            );
        }

        function Dashboard({ logs }) {
            return (
                <div className="space-y-4">
                    <div className="bg-white p-5 rounded-3xl shadow-sm">
                        <h3 className="font-bold text-sm text-gray-500 mb-4 flex items-center"><Trophy className="w-4 h-4 mr-2 text-yellow-500"/> ÚLTIMOS RECORDES</h3>
                        {logs.slice(0, 5).map(log => (
                            <div key={log.id} className="flex justify-between items-center border-b py-3 last:border-0">
                                <div>
                                    <div className="font-bold text-gray-800">{log.exercise}</div>
                                    <div className="text-xs text-gray-400">{log.workoutDate}</div>
                                </div>
                                <div className="text-right">
                                    <div className="font-black text-indigo-600">{log.weight}kg</div>
                                    <div className="text-[10px] text-gray-400">{log.reps} reps</div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
